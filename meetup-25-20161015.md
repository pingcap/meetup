---
title: ã€Infra Meetup No.25ã€‘åˆ†å¸ƒå¼æ•°æ®å¤„ç†åœ¨ä¸ªæ€§åŒ–ç³»ç»Ÿçš„åº”ç”¨ & TiKV æ€§èƒ½ä¼˜åŒ–
date: 2016-10-15
tags: ["åˆ†å¸ƒå¼å­˜å‚¨","åˆ†å¸ƒå¼è®¡ç®—","TiKV","æ€§èƒ½"]
author: ['æ­¦æ¯…','å¼ é‡‘é¹']
type: meetup
meetup_type: review
aliases: ['/meetup/meetup-2016-10-15/']
---


ä»Šå¤©æ˜¯ PingCAP ç¬¬ 25 æœŸ Meetupï¼Œé¡¶ç€å¸éƒ½çš„å¤§é›¾éœ¾ï¼Œä¾ç„¶æ¥äº†å¾ˆå¤šå°ä¼™ä¼´ã€‚è¿™ä¸€æ¬¡æˆ‘ä»¬æœ‰æ¢æ–°åœºåœ°å™¢ï¼Œä½†ä¸å˜çš„æ˜¯åˆ†äº«å†…å®¹ä¾ç„¶æ»¡æ»¡å¹²è´§ã€‚æœ¬å‘¨çš„ä¸»é¢˜åˆ†åˆ«æ˜¯ç™¾åˆ†ç‚¹é›†å›¢é«˜çº§æ¶æ„å¸ˆæ­¦æ¯…åˆ†äº«çš„ã€Šåˆ†å¸ƒå¼æ•°æ®å¤„ç†åœ¨ä¸ªæ€§åŒ–ç³»ç»Ÿçš„åº”ç”¨ã€‹ä»¥åŠå¼ é‡‘é¹åˆ†äº«çš„ã€ŠTiKV æ€§èƒ½ä¼˜åŒ–ã€‹ã€‚

### Topic 1ï¼šåˆ†å¸ƒå¼æ•°æ®å¤„ç†åœ¨ä¸ªæ€§åŒ–ç³»ç»Ÿçš„åº”ç”¨

![](http://upload-images.jianshu.io/upload_images/542677-7dc34b277df3f507?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

Lectureï¼š

æ­¦æ¯…ï¼Œç°ä»»ç™¾åˆ†ç‚¹é›†å›¢é«˜çº§æ¶æ„å¸ˆï¼Œè´Ÿè´£å¤§æ•°æ®å¹³å°åŸºç¡€æ¶æ„çš„è®¾è®¡ä¸ç ”å‘ï¼Œæ›¾å‚ä¸ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿç­‰å¤šä¸ªå¤§å‹ç³»ç»Ÿçš„è®¾è®¡å’Œå¼€å‘ã€‚Linux çˆ±å¥½è€…ï¼Œæ´»è·ƒäº GitHubï¼ŒUbuntu ç­‰ç¤¾åŒºï¼Œé‡ç‚¹å…³æ³¨åˆ†å¸ƒå¼æŠ€æœ¯ï¼Œå¹³å°æŠ€æœ¯ã€‚

Contentï¼š

ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½åœ¨å„è‡ªçš„é¢†åŸŸç”¨åˆ°è¿‡ä¸åŒçš„åˆ†å¸ƒå¼å­˜å‚¨ï¼è®¡ç®—å¼€æºå·¥å…·ï¼Œæœ¬å‘¨æˆ‘ä»¬åˆ†äº«äº†ä¸€äº›åœ¨è¿è¥ä¸ªæ€§åŒ–ç³»ç»Ÿæ—¶ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨ï¼è®¡ç®—å·¥å…·é‡åˆ°çš„å‘å’Œç»éªŒã€‚

### Topic 2ï¼šTiKV æ€§èƒ½ä¼˜åŒ–

![](http://upload-images.jianshu.io/upload_images/542677-fbbfa079bd59de24?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

Contentï¼š

RocksDB çš„ Column Families ä¹‹é—´ä¼šå…±äº« WALï¼Œä½†æ˜¯åˆæœ‰å„è‡ªçš„ memtables å’Œ sst filesï¼Œå…±äº« WAL ä½¿å¾—å®ç°è·¨ CF çš„ atomic æ“ä½œå˜æˆå¯èƒ½ï¼Œä¸åŒ CF çš„ memtables å’Œ sst files æ˜¯åˆ†ç¦»å¼€çš„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å°†ä¸åŒç±»å‹çš„æ•°æ®åˆ†åˆ«å­˜æ”¾åœ¨ä¸åŒçš„ CF å†…ï¼Œæ ¹æ®æ•°æ®çš„æ€§è´¨ç»™ CF å®šåˆ¶ä¸åŒé…ç½®ï¼Œä½¿æ•°æ®çš„å†™å…¥å’Œè®¿é—®è¾¾åˆ°æœ€ä½³çŠ¶æ€ã€‚

åœ¨ç›®å‰ TiKV ä¸­ï¼Œè¯»å‘½ä»¤åªèƒ½å‘ç»™ leaderï¼Œä»¥é˜²è¯»å–åˆ°æ—§çš„çŠ¶æ€ï¼Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­é€šè¿‡èµ°ä¸€æ¬¡ Raft æ¥ç¡®å®šå½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯ leaderï¼Œå¼•å…¥ leader lease ä¹‹åï¼Œå‘½ä»¤å‘é€åˆ°åœ¨ lease å†…çš„leader ä¸Šæ—¶ï¼Œä¸éœ€è¦å†èµ°ä¸€æ¬¡ Raft äº†ï¼Œå¯ä»¥ç›´æ¥è¯»å–æœ¬åœ°æ•°æ®ã€‚

å½“ RocksDB tombstone keys å¤ªå¤šçš„æ—¶å€™ seek æ“ä½œä¼šéå¸¸æ…¢ï¼Œå¯ä»¥æ ¹æ®æƒ…å†µä½¿ç”¨ iterator çš„ upper bound åŠŸèƒ½æˆ–è€…ä½¿ç”¨ RocksDB çš„ singledelete æ¥è§£å†³è¿™ä¸ªé—®é¢˜.

æœ€åæˆ‘ä»¬ç»™å‡ºäº†ä¸€äº›ä¸ MySQL çš„æ€§èƒ½å¯¹æ¯”æ•°æ®ã€‚å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨å†™å…¥æ€§èƒ½ã€èšåˆæ“ä½œå’Œä¸€äº›å¤æ‚æŸ¥è¯¢ä¸Šå·²ç»å®Œå…¨è¶…è¿‡ MySQL äº†ã€‚

![](http://upload-images.jianshu.io/upload_images/542677-9bef5f61070f580e?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

âœï¸Â åˆ†äº«ä¸¤å¼ æ–°åœºåœ°çš„å›¾ç‰‡ç»™ä½ ä»¬ï¼çœ‹ï½æ˜¯ä¸æ˜¯å®½æ•åˆæ˜äº® ğŸ˜Š

![](http://upload-images.jianshu.io/upload_images/542677-ff4feddbdd0edc99?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![](http://upload-images.jianshu.io/upload_images/542677-a247a4664b4c9f03?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

