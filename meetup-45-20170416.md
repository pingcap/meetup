---
title: ã€Infra Meetup No.45ã€‘Rust ä¸“åœº
date: 2017-04-16
tags: ["Rust","ownership","borrowing","TiKV","Rust"]
author: ['Alex Crichton','å”åˆ˜']
type: meetup
meetup_type: review
aliases: ['/meetup/meetup-2017-04-16']
---


![](http://upload-images.jianshu.io/upload_images/542677-fd976ca52edc60a1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

>ä»Šå¤©ï¼Œå°ä¼™ä¼´ä»¬æœŸå¾…å·²ä¹…çš„åŒ—äº¬ Rust Meetup ç»ˆäºå’Œå¤§å®¶è§é¢å•¦ï¼åœ¨è¿™åœº Rust ç¤¾åŒºåœ¨ä¸­å›½çš„é¦–æ¬¡å®˜æ–¹æ´»åŠ¨ä¸­ï¼Œæˆ‘ä»¬é‚€è¯·äº†ä¸¤ä½Â Rust å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜ï¼ŒAlex Crichtonã€Brian Andersonï¼Œä¸æˆ‘å¸é¦–å¸­æ¶æ„å¸ˆå”åˆ˜ï¼Œå…±åŒä¸ºå¤§å®¶å¸¦æ¥äº†å¹²è´§åè¶³çš„åˆ†äº«å†…å®¹~ç¬¬ä¸€æ‰‹ç°åœºèµ„æ–™ï¼Œçœ‹è¿™é‡Œï¼

![](http://upload-images.jianshu.io/upload_images/542677-6e3b8e179e2974c6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¿™ä¸€æ¬¡çš„ Meetupï¼Œå°ä¼™ä¼´ä»¬éƒ½å¥½ç§¯æ ğŸ‘ æå‰ä¸€å°æ—¶å°±æœ‰å…¥åœºæŠ¢åº§ä½çš„~ä¹Ÿæ˜¯è®©å°ç¼–æ„ŸåŠ¨åˆ°ä¸è¡Œ~~çŸ¥é“å¤§å®¶éƒ½å·²ç»è¿«ä¸åŠå¾…äº†ï¼Œç®€å•çš„å¼€åœºä¹‹åï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šå¹²è´§ï¼


## Concurrency and asynchronous IO in Rust

å¹¶å‘åœ¨å½“ä»Šç¼–ç¨‹é¢†åŸŸæ˜¯å¦‚æ­¤é‡è¦ï¼Œç„¶è€Œè¦æƒ³å®ç°å¹¶å‘ç¨‹åºé€šå¸¸ä¼šé¢ä¸´æ•°æ®ç«äº‰ï¼Œç«æ€ï¼Œæ­»é”ï¼Œæ‚¬ç©ºæŒ‡é’ˆï¼Œå¤šæ¬¡ free ç­‰é—®é¢˜ï¼ŒAlex åœ¨æœ¬æœŸ meetup é‡Œç»™æˆ‘ä»¬è®²è§£äº† Rust æ˜¯å¦‚ä½•ç”¨ ownership/borrowing ç³»ç»Ÿè§£å†³è¿™äº›é—®é¢˜çš„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯:

*   A mutable reference cannot be aliased

*   A reference cannot outlive its referent

![](http://upload-images.jianshu.io/upload_images/542677-ec2901db389d51d1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

>Alex Crichtonï¼ŒMozilla å·¥ç¨‹å¸ˆï¼ŒRust æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ã€‚ä»äº‹ Rust ç¼–ç¨‹è¯­è¨€æ–¹é¢çš„å·¥ä½œå·²æœ‰ 5 å¹´ã€‚åœ¨ Mozilla ä¸»è¦è´Ÿè´£ Rust çš„æ ‡å‡†åº“ã€Cargoã€å¼‚æ­¥ I/O å­ç³»ç»Ÿä»¥åŠ Rust æœ¬èº«çš„åŸºç¡€è®¾æ–½ã€‚ç›®å‰åœ¨åšå¼‚æ­¥ I/O æ ˆ Tokioã€‚

Rust è¯­è¨€æœ¬èº«åªæä¾›äº† ownership/borrowing æœºåˆ¶ï¼Œæ ‡å‡†åº“é‡Œæä¾›äº† threadï¼Œchannelï¼Œarcï¼Œatomicï¼Œmutex ç­‰åŸºç¡€è®¾æ–½ï¼Œä½†æ²¡æœ‰æä¾›è½»é‡çº§åç¨‹ï¼Œè¿™æ ·è™½è¯´å¹¶å‘ç¨‹åºå†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä¸ä¼šåªå±€é™äºä¸€ç§å¹¶å‘æ¨¡å‹ã€‚è€Œåï¼Œç®€å•ä»‹ç»äº†ç¬¬ä¸‰æ–¹å¹¶è¡Œåº“ rayon å’Œ crossbeamã€‚æœ€åé‡ç‚¹è®²è§£äº†å¼‚æ­¥ IO åº“ futuresã€‚

![](http://upload-images.jianshu.io/upload_images/542677-b38f0a588d8bb71c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

Alex åœ¨å°ä¸Šçš„åˆ†äº«åˆšåˆšç»“æŸï¼Œå°ä¸‹çš„å°ä¼™ä¼´ä»¬ä¾¿å¼€å§‹è¸Šè·ƒæé—®~è®©æˆ‘ä»¬é€’è¯ç­’çš„å¦¹å­ï¼Œä¸å¾—å·²å¼€å¯äº†æ»¡åœºé£æ¨¡å¼ :-D

![](http://upload-images.jianshu.io/upload_images/542677-fef92fa3f5db1302?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

Q&A æ—¶é—´æŠ¢ä¸åˆ°æœºä¼šï¼Œæ²¡å…³ç³»ï¼Œè¿˜æœ‰èŒ¶æ­‡æ—¶é—´å¯ä»¥åˆ©ç”¨ âœ§(â‰– â—¡ â‰–âœ¿)

## How We Use Rust in TiKV

TiKV æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ Key-Value æ•°æ®åº“ï¼Œå®ƒé€šè¿‡ Raft æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„å¤åˆ¶ï¼Œä¿è¯æ•°æ®å®‰å…¨ï¼Œæä¾›äº†åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒï¼Œcoprocessor computing æ”¯æŒç­‰ã€‚ä¸ºäº†æ”¯æŒè¿™äº› featureï¼Œéœ€è¦é€‰æ‹©ä¸€é—¨é«˜æ€§èƒ½çš„è¯­è¨€ï¼Œä¸èƒ½æœ‰ memory é—®é¢˜ï¼Œä¸èƒ½ç”¨ data race é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¿è¯èƒ½å¿«é€Ÿçš„å¯¹ TiKV è¿›è¡Œå¼€å‘è¿­ä»£ï¼ŒåŸºäºè¿™äº›åŸå› ï¼Œ PingCAP å›¢é˜Ÿé€‰æ‹©äº† Rust ä½œä¸º TiKV çš„å¼€å‘è¯­è¨€ã€‚

![](http://upload-images.jianshu.io/upload_images/542677-1a1131f0e679c3d1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

>å”åˆ˜ï¼ŒPingCAPÂ é¦–å¸­æ¶æ„å¸ˆï¼Œåˆ†å¸ƒå¼å­˜å‚¨å¼•æ“ TiKV é¡¹ç›®è´Ÿè´£äººã€‚åˆ†å¸ƒå¼æ•°æ®åº“ä¸“å®¶ï¼ŒçŸ¥åå¼€æºè½¯ä»¶ LedisDB / RebornDB / Mixer ä½œè€…ã€‚

åœ¨ Rust å…³é”®æŠ€æœ¯é€‰æ‹©ä¸Šé¢ï¼Œå”åˆ˜è¡¨ç¤ºï¼šâ€œé¦–å…ˆæˆ‘ä»¬é€‰æ‹© mio ä½œä¸ºæ•´ä¸ªç½‘ç»œå¤„ç†ä»¥åŠå¼‚æ­¥å¤„ç†çš„æ¡†æ¶ã€‚ä½† mio è¿‡äºåº•å±‚ï¼Œéœ€è¦é¢å¤–åšå¾ˆå¤šå·¥ä½œï¼Œè€Œä¸” mio çš„ callback å†™æ³•å¾ˆå®¹æ˜“é€ æˆä»£ç é€»è¾‘çš„å‰²è£‚ã€‚æ‰€ä»¥åé¢ï¼Œæˆ‘ä»¬å¼€å§‹ä½¿ç”¨Â gRPC é‡æ„æ•´ä¸ªç½‘ç»œæ¨¡å—ï¼ŒåŒæ—¶ä½¿ç”¨ tokio-core ä»¥åŠ futures æœºåˆ¶æ¥é‡æ„æ•´ä¸ªå¼‚æ­¥æ¡†æ¶ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¼€å¯äº† clippy åœ¨ç¼–è¯‘çš„æ—¶å€™å¯¹ TiKV è¿›è¡Œæ›´å¤šçš„æ£€æŸ¥ï¼Œä¿è¯ä»£ç çš„å®‰å…¨ã€‚å¹¶åµŒå…¥äº†ä¸€äº› profile å’Œ monitoring çš„å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬åœ¨ TiKV è¿è¡Œæ—¶åŠ¨æ€çš„æ’æŸ¥é—®é¢˜ã€‚â€

![](http://upload-images.jianshu.io/upload_images/542677-b41981eb3b139e16?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¿™æ˜¯ä¸€åœºÂ Q&A æ—¶é•¿å‡ è¿‘èµ¶è¶… Talk æ—¶é•¿çš„ä¸€æ¬¡åˆ†äº«ï½ğŸ˜œÂ 

å®¾ä¸»å°½æ¬¢åï¼Œå½“ç„¶æ˜¯è¦è®°å½•ä¸‹è¿™ç¾å¥½ç¬é—´å•¦ï½ï½

![](http://upload-images.jianshu.io/upload_images/542677-c674c2a9a77e99de?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä¸ç®¡ä½ ä»¬æ‹ç…§æ˜¯å–ŠèŒ„å­è¿˜æ˜¯ Cheersï¼Œåæ­£æˆ‘ä»¬åªå–Šï¼šLet's Rust the Worldï¼

æœ€åé™„èµ ä¸¤å¼ ä¾§é¢æ€~~ (à¹‘â€¢á´—â€¢à¹‘)

![](http://upload-images.jianshu.io/upload_images/542677-4a6dc5a7739c5a9a?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![](http://upload-images.jianshu.io/upload_images/542677-751102a2ccfcd22e?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


